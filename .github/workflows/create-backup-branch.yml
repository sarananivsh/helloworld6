- name: Checkout repository
  uses: actions/checkout@v3
  with:
    token: ${{ secrets.GITHUB_TOKEN }}

- name: Create Mule3_backup branch (if not exists)
  if: env.backup_exists == 'false'
  run: |
    # Define the backup branch name
    BACKUP_BRANCH="Mule3_backup"
    
    # Fetch the latest changes from the remote repository
    git fetch origin
    
    # Checkout the PR branch using GitHub CLI (or use the default branch if no PR)
    gh pr checkout ${{ github.event.pull_request.number }} || git checkout main
    
    # Create a new backup branch from the main (or current PR branch)
    git checkout -b $BACKUP_BRANCH
    
    # Set the user name and email for git commits
    git config user.name "GitHub Actions"
    git config user.email "github-actions[bot]@users.noreply.github.com"
    
    # Push the new backup branch to the remote repository
    git push https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }} $BACKUP_BRANCH
