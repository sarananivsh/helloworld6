name: Create and Push Backup Branch

on:
  workflow_dispatch:  # Triggered manually or by API call
  push:
    branches:
      - main  # You can change this to whatever branch you want to trigger the workflow

jobs:
  create-backup-branch:
    runs-on: ubuntu-latest

    permissions:
      contents: write  # Ensure write access to contents for creating branches

    steps:
    # Step 1: Check out the repository
    - name: Checkout code
      uses: actions/checkout@v2

    # Step 2: Check if the folder exists
    - name: Check if folder exists
      id: check-folder
      run: |
        # Replace 'path_to_folder' with the folder you want to check
        if [ -d "path_to_folder" ]; then
          echo "Folder exists"
          echo "exists=true" >> $GITHUB_ENV
        else
          echo "Folder does not exist"
          echo "exists=false" >> $GITHUB_ENV
        fi

    # Step 3: Create and push the new branch only if the folder does not exist
    - name: Create and push new branch
      if: env.exists == 'false'  # Only run if the folder doesn't exist
      run: |
        # Set up Git user for actions
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"

        # Fetch the latest changes from the remote repository
        git fetch origin

        # Create and switch to the new branch
        git checkout -b Mule3_backup

        # Rebase the new branch onto the latest changes from the remote main branch
        git rebase origin/main

        # Push the new branch to the repository
        git push origin Mule3_backup
